define(["jquery","core/templates","block_stash/counselor","block_stash/drop","core/notification","block_stash/trade"],function(a,b,c,d,e,f){function g(b){this._node=a(b),this._setUp(),this._update()}return g.prototype._node=null,g.prototype._setUp=function(){c.on(d.prototype.EVENT_PICKEDUP,this._dropPickedUpListener.bind(this)),c.on(f.prototype.EVENT_TRADE,this._dropPickedUpListener.bind(this))},g.prototype.containsItem=function(a){return this.getTradeItemNode(a).length>0},g.prototype._dropPickedUpListener=function(a,b){var c=b.useritem;this.containsItem(c.getItem().get("id"))&&this.updateTradeItemUserQuantity(c)},g.prototype.canTradeItems=function(){var b=this._node.find(".removed-items"),c=!0;return b.each(function(b,d){c=c&&a(d).data("hasenough")}),c},g.prototype.getTradeItemNode=function(a){return this._node.find(".removed-items[data-itemid="+a+"]")},g.prototype.updateTradeItemUserQuantity=function(c){var d=c.getItem().get("id"),f=this.getTradeItemNode(d),g=parseInt(c.get("quantity"),10),h=parseInt(f.attr("data-quantity"),10),i=f.parent().attr("data-tradeid"),j=c.getItem().get("name"),k=g>=h,l={enoughitems:k,itemid:d,quantity:h,name:j,userquantity:g};b.render("block_stash/tradeitem_detail",l).done(function(c,e){b.replaceNodeContents(a(".block-stash-trade-item-"+d+'[data-tradeid="'+i+'"]'),c,e),this._update()}.bind(this)).fail(e.exception)},g.prototype._update=function(){var a=this._node.find(".accept-trade button").first();a&&(this.canTradeItems()?a.prop("disabled",!1):a.prop("disabled",!0))},g});