define(["jquery","core/ajax","core/templates","core/yui"],function(a,b,c,d){function e(b){var c=a.Deferred();this._ready=c.promise(),this._itemid=b,d.use("moodle-core-notification",function(){this._init().then(function(){c.resolve()})}.bind(this))}return e.prototype._dialogue=null,e.prototype._itemid=null,e.prototype._item=null,e.prototype._maker=null,e.prototype._ready=null,e.prototype._ui=null,e.prototype._init=function(){var b,e=a.Deferred(),f=d.Node.create('<p style="text-align: center;"><img src="'+M.util.image_url("y/loading")+'" alt=""></p>');b=new M.core.dialogue({draggable:!0,modal:!0,width:"600px"}),this._dialogue=b;var g=b.hide;return b.hide=function(){g.apply(b,arguments),this.destroy()}.bind(b),this._getItem().then(function(a){b.getStdModNode(d.WidgetStdMod.HEADER).prepend(d.Node.create("<h1>"+a.name+"</h1>")),b.setStdModContent(d.WidgetStdMod.BODY,f,d.WidgetStdMod.REPLACE),c.render("block_stash/item_detail",a).then(function(a,f){c.runTemplateJS(f),b.setStdModContent(d.WidgetStdMod.BODY,a,d.WidgetStdMod.REPLACE),b.centerDialogue(),e.resolve()}).fail(e.reject)}).fail(e.reject),e.promise()},e.prototype.find=function(a){return this._container.find(a)},e.prototype._getItem=function(){var c=b.call([{methodname:"block_stash_get_item_detail",args:{itemid:this._itemid}}],!1),d=a.Deferred();return c[0].done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},e.prototype.show=function(a){this._ready.then(function(){this._dialogue.show(a)}.bind(this))},e});