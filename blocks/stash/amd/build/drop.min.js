define(["jquery","core/ajax","core/log","block_stash/base","block_stash/counselor","block_stash/item","block_stash/user-item"],function(a,b,c,d,e,f,g){function h(a,b){d.prototype.constructor.apply(this,[a]),this._item=b}return h.prototype=Object.create(d.prototype),h.prototype.EVENT_PICKEDUP="drop:pickedup",h.prototype.getItem=function(){return this._item},h.prototype.isVisible=function(){return b.call([{methodname:"block_stash_is_drop_visible",args:{dropid:this.get("id"),hashcode:this.get("hashcode")}}])[0].then(function(b){return!!b||a.Deferred().reject()})},h.prototype.pickup=function(){return b.call([{methodname:"block_stash_pickup_drop",args:{dropid:this.get("id"),hashcode:this.get("hashcode")}}])[0].fail(function(){c.debug("The item could not be picked up.")}).then(function(a){var b=new g(a.useritem,new f(a.item));e.trigger(this.EVENT_PICKEDUP,{id:this.get("id"),hashcode:this.get("hashcode"),useritem:b})}.bind(this))},h});