define(["jquery"],function(a){var b={baseUrl:"",sessKey:"",qid:"",init:function(){var c=a("#attemptsform").attr("action");b.baseUrl=c.replace("testquestion.php","api/updater.php"),b.sessKey=a('#attemptsform input[name="sesskey"]').val(),b.qid=a('#attemptsform input[name="id"]').val(),a(".updater-expectedfraction").each(function(){var c=a(this).attr("id");if(c){var d=c.slice(0,-1)+"1",e=a(this).prevAll("#"+d).text(),f=a(this).text();""===f&&(f="&nbsp;&nbsp;"),a(this).html('<a href="#" title="Change score" id="updater-ef_'+e+'">'+f+"</a>"),a("#updater-ef_"+e).click(function(){return b.update(e),!1})}}),a(document).ajaxError(function(){window.alert("Sorry there appears to be an error connecting to the server.\nPlease try again later. (Sometimes refreshing the page can avoid a session timeout issue.)")})},update:function(c){var d=a("#updater-ef_"+c).text(),e=0;e="1"===d?0:1;var f={qid:b.qid,rid:c,expectedfraction:e,sesskey:b.sessKey};a.post(b.baseUrl,f,function(b){if("success"===b.status){a("#updater-ef_"+c).text(b.ef),a("#updater-ef_"+c).parent().prev().text(b.gf);var d=a("#updater-ef_"+c).parent().parent();d.removeClass(),d.addClass(b.rowclass),d.find('td[class="c3"]').text(b.gf);var e=M.util.get_string("testquestionresultssummary","qtype_pmatch",b.counts);a("#testquestion_gradesummary").html(e)}else window.console.log("Testquestion response updater has experienced an issue.\n"+b.data)})}};return b});