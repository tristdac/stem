!function(a,b){"function"==typeof define&&define.amd?define(["mod_treasurehunt/ol"],b):"object"==typeof module&&module.exports?module.exports=b(require("mod_treasurehunt/ol")):a.LayerSwitcher=b(a.ol)}(this,function(a){a.control.LayerSwitcher=function(b){var c=b||{},d=c.tipLabel?c.tipLabel:"Legend";this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",a.control.LayerSwitcher.isTouchDevice_()&&(this.hiddenClassName+=" touch"),this.shownClassName="shown";var e=document.createElement("div");e.className=this.hiddenClassName;var f=document.createElement("button");f.setAttribute("title",d),e.appendChild(f),this.panel=document.createElement("div"),this.panel.className="panel",e.appendChild(this.panel),a.control.LayerSwitcher.enableTouchScroll_(this.panel);var g=this;f.onmouseover=function(a){g.showPanel()},f.onclick=function(a){a=a||window.event,g.showPanel(),a.preventDefault()},g.panel.onmouseout=function(a){a=a||window.event,g.panel.contains(a.toElement||a.relatedTarget)||g.hidePanel()},a.control.Control.call(this,{element:e,target:c.target})},a.inherits(a.control.LayerSwitcher,a.control.Control),a.control.LayerSwitcher.prototype.showPanel=function(){this.element.classList.contains(this.shownClassName)||(this.element.classList.add(this.shownClassName),this.renderPanel())},a.control.LayerSwitcher.prototype.hidePanel=function(){this.element.classList.contains(this.shownClassName)&&this.element.classList.remove(this.shownClassName)},a.control.LayerSwitcher.prototype.renderPanel=function(){for(this.ensureTopVisibleBaseLayerShown_();this.panel.firstChild;)this.panel.removeChild(this.panel.firstChild);var a=document.createElement("ul");this.panel.appendChild(a),this.renderLayers_(this.getMap(),a)},a.control.LayerSwitcher.prototype.setMap=function(b){for(var c=0;c<this.mapListeners.length;c++)a.Observable.unByKey(this.mapListeners[c]);if(this.mapListeners.length=0,a.control.Control.prototype.setMap.call(this,b),b){var d=this;this.mapListeners.push(b.on("pointerdown",function(){d.hidePanel()})),this.renderPanel()}},a.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_=function(){var b;a.control.LayerSwitcher.forEachRecursive(this.getMap(),function(a,c,d){"base"===a.get("type")&&a.getVisible()&&(b=a)}),b&&this.setVisible_(b,!0)},a.control.LayerSwitcher.prototype.setVisible_=function(b,c){var d=this.getMap();b.setVisible(c),c&&"base"===b.get("type")&&a.control.LayerSwitcher.forEachRecursive(d,function(a,c,d){a!=b&&"base"===a.get("type")&&a.setVisible(!1)})},a.control.LayerSwitcher.prototype.renderLayer_=function(b,c){var d=this,e=document.createElement("li"),f=b.get("title"),g=a.control.LayerSwitcher.uuid(),h=document.createElement("label");if(b.getLayers&&!b.get("combine")){e.className="group",h.innerHTML=f,e.appendChild(h);var i=document.createElement("ul");e.appendChild(i),this.renderLayers_(b,i)}else{e.className="layer";var j=document.createElement("input");"base"===b.get("type")?(j.type="radio",j.name="base"):j.type="checkbox",j.id=g,j.checked=b.get("visible"),j.onchange=function(a){d.setVisible_(b,a.target.checked)},e.appendChild(j),h.htmlFor=g,h.innerHTML=f;var k=this.getMap().getView().getResolution();(k>b.getMaxResolution()||k<b.getMinResolution())&&(h.className+=" disabled"),e.appendChild(h)}return e},a.control.LayerSwitcher.prototype.renderLayers_=function(a,b){for(var c,d=a.getLayers().getArray().slice().reverse(),e=0;e<d.length;e++)c=d[e],c.get("title")&&b.appendChild(this.renderLayer_(c,e))},a.control.LayerSwitcher.forEachRecursive=function(b,c){b.getLayers().forEach(function(b,d,e){c(b,d,e),b.getLayers&&a.control.LayerSwitcher.forEachRecursive(b,c)})},a.control.LayerSwitcher.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},a.control.LayerSwitcher.enableTouchScroll_=function(b){if(a.control.LayerSwitcher.isTouchDevice_()){var c=0;b.addEventListener("touchstart",function(a){c=this.scrollTop+a.touches[0].pageY},!1),b.addEventListener("touchmove",function(a){this.scrollTop=c-a.touches[0].pageY},!1)}},a.control.LayerSwitcher.isTouchDevice_=function(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}};var b=a.control.LayerSwitcher;return b});